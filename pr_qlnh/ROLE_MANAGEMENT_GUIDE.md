# HÆ°á»›ng dáº«n Quáº£n lÃ½ Vai trÃ²

## Tá»•ng quan

Há»‡ thá»‘ng quáº£n lÃ½ vai trÃ² Ä‘Ã£ Ä‘Æ°á»£c cáº£i thiá»‡n vá»›i giao diá»‡n má»›i, validation Ä‘áº§y Ä‘á»§ vÃ  xá»­ lÃ½ lá»—i tá»‘t hÆ¡n.

---

## TÃ­nh nÄƒng

### âœ… 1. Xem danh sÃ¡ch vai trÃ²
- Hiá»ƒn thá»‹ táº¥t cáº£ vai trÃ² trong há»‡ thá»‘ng
- ThÃ´ng tin: ID, TÃªn, MÃ´ táº£, Sá»‘ ngÆ°á»i dÃ¹ng, NgÃ y táº¡o, NgÃ y cáº­p nháº­t
- Badge mÃ u sáº¯c cho sá»‘ ngÆ°á»i dÃ¹ng:
  - ğŸ”µ Xanh: CÃ³ ngÆ°á»i dÃ¹ng
  - âšª XÃ¡m: KhÃ´ng cÃ³ ngÆ°á»i dÃ¹ng

### âœ… 2. ThÃªm vai trÃ² má»›i
**CÃ¡ch sá»­ dá»¥ng:**
1. Click nÃºt **"+ ThÃªm vai trÃ²"**
2. Nháº­p thÃ´ng tin:
   - **TÃªn vai trÃ²** (báº¯t buá»™c, tá»‘i Ä‘a 100 kÃ½ tá»±)
   - **MÃ´ táº£** (tÃ¹y chá»n, tá»‘i Ä‘a 255 kÃ½ tá»±)
3. Click **"ThÃªm vai trÃ²"**

**Validation:**
- âœ… TÃªn khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng
- âœ… TÃªn khÃ´ng Ä‘Æ°á»£c quÃ¡ 100 kÃ½ tá»±
- âœ… MÃ´ táº£ khÃ´ng Ä‘Æ°á»£c quÃ¡ 255 kÃ½ tá»±
- âœ… TÃªn pháº£i lÃ  duy nháº¥t (backend check)

**Giao diá»‡n:**
- Modal mÃ u xanh lÃ¡ vá»›i icon Shield
- Auto-focus vÃ o Ã´ tÃªn vai trÃ²
- Hiá»ƒn thá»‹ lá»—i realtime khi nháº­p sai
- ThÃ´ng bÃ¡o thÃ nh cÃ´ng sau khi thÃªm

---

### âœ… 3. Sá»­a vai trÃ²
**CÃ¡ch sá»­ dá»¥ng:**
1. Click vÃ o icon **"â‹®"** (More) á»Ÿ hÃ ng vai trÃ²
2. Modal hiá»ƒn thá»‹ thÃ´ng tin:
   - TÃªn vai trÃ²
   - MÃ´ táº£
   - Sá»‘ ngÆ°á»i dÃ¹ng
   - Sá»‘ quyá»n háº¡n
3. Chá»‰nh sá»­a thÃ´ng tin
4. Click **"LÆ°u thay Ä‘á»•i"**

**Validation:**
- âœ… TÃªn khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng
- âœ… TÃªn khÃ´ng Ä‘Æ°á»£c quÃ¡ 100 kÃ½ tá»±
- âœ… MÃ´ táº£ khÃ´ng Ä‘Æ°á»£c quÃ¡ 255 kÃ½ tá»±

**Giao diá»‡n:**
- Modal mÃ u indigo vá»›i icon Shield
- Hiá»ƒn thá»‹ thá»‘ng kÃª:
  - ğŸ‘¥ Sá»‘ ngÆ°á»i dÃ¹ng (badge xanh)
  - ğŸ›¡ï¸ Sá»‘ quyá»n háº¡n (badge xanh lÃ¡)
- Cáº£nh bÃ¡o mÃ u vÃ ng náº¿u cÃ³ ngÆ°á»i dÃ¹ng
- NÃºt xÃ³a disabled náº¿u cÃ³ ngÆ°á»i dÃ¹ng

---

### âœ… 4. XÃ³a vai trÃ²
**CÃ¡ch sá»­ dá»¥ng:**
1. Click icon **ğŸ—‘ï¸** (Trash) á»Ÿ hÃ ng vai trÃ²
2. Hoáº·c click **"XÃ³a"** trong modal sá»­a
3. XÃ¡c nháº­n xÃ³a

**RÃ ng buá»™c:**
- âŒ **KHÃ”NG thá»ƒ xÃ³a** náº¿u vai trÃ² Ä‘ang cÃ³ ngÆ°á»i dÃ¹ng
- âœ… **CÃ³ thá»ƒ xÃ³a** náº¿u vai trÃ² khÃ´ng cÃ³ ngÆ°á»i dÃ¹ng

**Giao diá»‡n:**
- NÃºt xÃ³a mÃ u Ä‘á» khi cÃ³ thá»ƒ xÃ³a
- NÃºt xÃ³a mÃ u xÃ¡m (disabled) khi cÃ³ ngÆ°á»i dÃ¹ng
- Tooltip: "KhÃ´ng thá»ƒ xÃ³a - CÃ³ X ngÆ°á»i dÃ¹ng"
- Confirm dialog hiá»ƒn thá»‹ tÃªn vai trÃ²

**ThÃ´ng bÃ¡o:**
```
âœ… ThÃ nh cÃ´ng: "XÃ³a vai trÃ² thÃ nh cÃ´ng!"
âŒ CÃ³ ngÆ°á»i dÃ¹ng: "KhÃ´ng thá»ƒ xÃ³a vai trÃ² nÃ y vÃ¬ cÃ³ X ngÆ°á»i dÃ¹ng Ä‘ang sá»­ dá»¥ng!"
âš ï¸ ÄÃ£ bá»‹ xÃ³a: "Vai trÃ² khÃ´ng tá»“n táº¡i. CÃ³ thá»ƒ Ä‘Ã£ bá»‹ xÃ³a bá»Ÿi ngÆ°á»i dÃ¹ng khÃ¡c."
```

---

## Xá»­ lÃ½ Multi-Tab

### Scenario 1: Tab 1 xÃ³a â†’ Tab 2 xÃ³a
- Tab 1: XÃ³a thÃ nh cÃ´ng âœ…
- Tab 2: ThÃ´ng bÃ¡o "ÄÃ£ bá»‹ xÃ³a bá»Ÿi ngÆ°á»i dÃ¹ng khÃ¡c" + Tá»± Ä‘á»™ng reload

### Scenario 2: Tab 1 má»Ÿ modal sá»­a â†’ Tab 2 xÃ³a â†’ Tab 1 lÆ°u
- Tab 1: ThÃ´ng bÃ¡o "Vui lÃ²ng táº£i láº¡i trang" + ÄÃ³ng modal + Reload

---

## Components

### 1. **RoleManager.jsx**
- Component chÃ­nh quáº£n lÃ½ state
- Xá»­ lÃ½ API calls
- Xá»­ lÃ½ lá»—i vÃ  thÃ´ng bÃ¡o

### 2. **RoleTable.jsx**
- Hiá»ƒn thá»‹ danh sÃ¡ch vai trÃ²
- Badge sá»‘ ngÆ°á»i dÃ¹ng
- NÃºt xÃ³a vá»›i visual feedback

### 3. **RoleAddModal.jsx** (Má»šI)
- Modal thÃªm vai trÃ²
- Validation form
- Giao diá»‡n mÃ u xanh lÃ¡

### 4. **RoleEditModal.jsx** (Má»šI)
- Modal sá»­a vai trÃ²
- Hiá»ƒn thá»‹ thá»‘ng kÃª
- NÃºt xÃ³a cÃ³ Ä‘iá»u kiá»‡n
- Cáº£nh bÃ¡o khi cÃ³ ngÆ°á»i dÃ¹ng

### 5. **RoleDetailsModal.jsx** (CÅ¨ - KhÃ´ng dÃ¹ng)
- File cÅ© dÃ nh cho User
- ÄÃ£ Ä‘Æ°á»£c thay tháº¿ bá»Ÿi RoleEditModal

---

## API Endpoints

### GET `/api/roles`
**Response:**
```json
[
  {
    "id": 1,
    "name": "Admin",
    "description": "Quáº£n trá»‹ viÃªn há»‡ thá»‘ng",
    "permissions_count": 10,
    "users_count": 2,
    "permissions": ["create_user", "delete_user"],
    "created_at": "2024-01-01",
    "updated_at": "2024-01-01"
  }
]
```

### POST `/api/roles`
**Request:**
```json
{
  "name": "Manager",
  "description": "Quáº£n lÃ½ nhÃ¢n viÃªn"
}
```

### PUT `/api/roles/{id}`
**Request:**
```json
{
  "name": "Manager Updated",
  "description": "Quáº£n lÃ½ nhÃ¢n viÃªn vÃ  dá»± Ã¡n"
}
```

**Response (404 - ÄÃ£ bá»‹ xÃ³a):**
```json
{
  "message": "Vai trÃ² khÃ´ng tá»“n táº¡i. CÃ³ thá»ƒ Ä‘Ã£ bá»‹ xÃ³a bá»Ÿi ngÆ°á»i dÃ¹ng khÃ¡c.",
  "deleted": true
}
```

### DELETE `/api/roles/{id}`
**Response (400 - CÃ³ ngÆ°á»i dÃ¹ng):**
```json
{
  "message": "KhÃ´ng thá»ƒ xÃ³a vai trÃ² nÃ y vÃ¬ cÃ³ 5 ngÆ°á»i dÃ¹ng Ä‘ang sá»­ dá»¥ng!",
  "users_count": 5
}
```

**Response (404 - ÄÃ£ bá»‹ xÃ³a):**
```json
{
  "message": "Vai trÃ² khÃ´ng tá»“n táº¡i. CÃ³ thá»ƒ Ä‘Ã£ bá»‹ xÃ³a bá»Ÿi ngÆ°á»i dÃ¹ng khÃ¡c.",
  "deleted": true
}
```

---

## Validation Rules

### Backend (Laravel)
```php
'name' => 'required|unique:roles,name|max:100',
'description' => 'nullable|string|max:255'
```

### Frontend (React)
- TÃªn: Required, max 100 kÃ½ tá»±
- MÃ´ táº£: Optional, max 255 kÃ½ tá»±
- Realtime validation khi nháº­p
- Hiá»ƒn thá»‹ lá»—i dÆ°á»›i input

---

## Error Handling

### 1. **404 - Not Found**
```javascript
if (err.response?.status === 404 && err.response?.data?.deleted) {
  alert("âš ï¸ Vai trÃ² khÃ´ng tá»“n táº¡i. CÃ³ thá»ƒ Ä‘Ã£ bá»‹ xÃ³a bá»Ÿi ngÆ°á»i dÃ¹ng khÃ¡c.\n\nVui lÃ²ng táº£i láº¡i trang.");
  await loadRole(); // Auto reload
}
```

### 2. **400 - Bad Request**
```javascript
if (err.response?.status === 400) {
  const errorData = err.response.data;
  alert(`âŒ ${errorData.message}\n\nSá»‘ ngÆ°á»i dÃ¹ng: ${errorData.users_count}`);
}
```

### 3. **422 - Validation Error**
```javascript
// Backend tráº£ vá» validation errors
{
  "message": "The name has already been taken.",
  "errors": {
    "name": ["The name has already been taken."]
  }
}
```

---

## UI/UX Improvements

### âœ… Visual Feedback
- Badge mÃ u sáº¯c cho sá»‘ ngÆ°á»i dÃ¹ng
- NÃºt xÃ³a disabled khi cÃ³ rÃ ng buá»™c
- Tooltip giáº£i thÃ­ch lÃ½ do khÃ´ng thá»ƒ xÃ³a
- Loading state khi Ä‘ang táº£i dá»¯ liá»‡u

### âœ… User Experience
- Auto-focus vÃ o input khi má»Ÿ modal
- Confirm dialog vá»›i tÃªn vai trÃ²
- ThÃ´ng bÃ¡o rÃµ rÃ ng, dá»… hiá»ƒu
- Tá»± Ä‘á»™ng reload sau khi thÃªm/sá»­a/xÃ³a
- Xá»­ lÃ½ xung Ä‘á»™t multi-tab

### âœ… Accessibility
- Keyboard navigation
- Screen reader friendly
- Clear error messages
- Consistent button placement

---

## Testing Checklist

### ThÃªm vai trÃ²
- [ ] ThÃªm vá»›i tÃªn há»£p lá»‡
- [ ] ThÃªm vá»›i tÃªn trÃ¹ng (expect error)
- [ ] ThÃªm vá»›i tÃªn quÃ¡ dÃ i (expect error)
- [ ] ThÃªm vá»›i tÃªn rá»—ng (expect error)
- [ ] ThÃªm vá»›i mÃ´ táº£ quÃ¡ dÃ i (expect error)

### Sá»­a vai trÃ²
- [ ] Sá»­a tÃªn vÃ  mÃ´ táº£
- [ ] Sá»­a thÃ nh tÃªn trÃ¹ng (expect error)
- [ ] Sá»­a vai trÃ² Ä‘Ã£ bá»‹ xÃ³a (expect 404)
- [ ] Validation realtime

### XÃ³a vai trÃ²
- [ ] XÃ³a vai trÃ² khÃ´ng cÃ³ ngÆ°á»i dÃ¹ng (success)
- [ ] XÃ³a vai trÃ² cÃ³ ngÆ°á»i dÃ¹ng (expect 400)
- [ ] XÃ³a vai trÃ² Ä‘Ã£ bá»‹ xÃ³a (expect 404)
- [ ] Visual feedback (disabled button)

### Multi-tab
- [ ] Tab 1 xÃ³a â†’ Tab 2 xÃ³a (expect 404)
- [ ] Tab 1 sá»­a â†’ Tab 2 xÃ³a â†’ Tab 1 lÆ°u (expect 404)
- [ ] Auto reload sau xung Ä‘á»™t

---

## Káº¿t luáº­n

Há»‡ thá»‘ng quáº£n lÃ½ vai trÃ² Ä‘Ã£ Ä‘Æ°á»£c cáº£i thiá»‡n toÃ n diá»‡n:
- âœ… Giao diá»‡n Ä‘áº¹p, hiá»‡n Ä‘áº¡i
- âœ… Validation Ä‘áº§y Ä‘á»§
- âœ… Xá»­ lÃ½ lá»—i tá»‘t
- âœ… Há»— trá»£ multi-tab
- âœ… UX thÃ¢n thiá»‡n
- âœ… Code clean, dá»… maintain
